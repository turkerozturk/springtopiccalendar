<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!--/*
    This file is part of the DailyTopicTracker project.
    Please refer to the project's README.md file for additional details.
    https://github.com/turkerozturk/springtopiccalendar
    */-->
    <meta charset="UTF-8">

    <!--/* favicon */-->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon-180x180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">

    <title>Intelligent Report - Daily Topic Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">

    <link rel="stylesheet" type="text/css" th:href="@{/webjars/font-awesome/css/all.min.css}">





    <style>

        body {
background-color: #DFDBE5;
background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657 8.787 5.07 13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83zm20.97 0l9.315 9.314-1.414 1.414L34.828 0h2.83zM22.344 0L13.03 9.314l1.414 1.414L25.172 0h-2.83zM32 0l12.142 12.142-1.414 1.414L30 .828 17.272 13.556l-1.414-1.414L28 0h4zM.284 0l28 28-1.414 1.414L0 2.544V0h.284zM0 5.373l25.456 25.455-1.414 1.415L0 8.2V5.374zm0 5.656l22.627 22.627-1.414 1.414L0 13.86v-2.83zm0 5.656l19.8 19.8-1.415 1.413L0 19.514v-2.83zm0 5.657l16.97 16.97-1.414 1.415L0 25.172v-2.83zM0 28l14.142 14.142-1.414 1.414L0 30.828V28zm0 5.657L11.314 44.97 9.9 46.386l-9.9-9.9v-2.828zm0 5.657L8.485 47.8 7.07 49.212 0 42.143v-2.83zm0 5.657l5.657 5.657-1.414 1.415L0 47.8v-2.83zm0 5.657l2.828 2.83-1.414 1.413L0 53.456v-2.83zM54.627 60L30 35.373 5.373 60H8.2L30 38.2 51.8 60h2.827zm-5.656 0L30 41.03 11.03 60h2.828L30 43.858 46.142 60h2.83zm-5.656 0L30 46.686 16.686 60h2.83L30 49.515 40.485 60h2.83zm-5.657 0L30 52.343 22.343 60h2.83L30 55.172 34.828 60h2.83zM32 60l-2-2-2 2h4zM59.716 0l-28 28 1.414 1.414L60 2.544V0h-.284zM60 5.373L34.544 30.828l1.414 1.415L60 8.2V5.374zm0 5.656L37.373 33.656l1.414 1.414L60 13.86v-2.83zm0 5.656l-19.8 19.8 1.415 1.413L60 19.514v-2.83zm0 5.657l-16.97 16.97 1.414 1.415L60 25.172v-2.83zM60 28L45.858 42.142l1.414 1.414L60 30.828V28zm0 5.657L48.686 44.97l1.415 1.415 9.9-9.9v-2.828zm0 5.657L51.515 47.8l1.414 1.413 7.07-7.07v-2.83zm0 5.657l-5.657 5.657 1.414 1.415L60 47.8v-2.83zm0 5.657l-2.828 2.83 1.414 1.413L60 53.456v-2.83zM39.9 16.385l1.414-1.414L30 3.658 18.686 14.97l1.415 1.415 9.9-9.9 9.9 9.9zm-2.83 2.828l1.415-1.414L30 9.313 21.515 17.8l1.414 1.413 7.07-7.07 7.07 7.07zm-2.827 2.83l1.414-1.416L30 14.97l-5.657 5.657 1.414 1.415L30 17.8l4.243 4.242zm-2.83 2.827l1.415-1.414L30 20.626l-2.828 2.83 1.414 1.414L30 23.456l1.414 1.414zM56.87 59.414L58.284 58 30 29.716 1.716 58l1.414 1.414L30 32.544l26.87 26.87z' fill='%239C92AC' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .css-archived {
          background-color: LightGray !important;
       }

        .negative-weighted-entry {
            background-color: #e6ccff; /* Açık mor tonu */
        }
        .normal-weighted-entry {
            background-color: #ccffe6;
        }
        .positive-weighted-entry {
            background-color: #ffe6cc;
        }

        .highlight-today {
            background-color: #fff9c4; /* açık sarı */
        }



        body {
      margin: 0px;
  }

  #navigation-panel button, a{


    border-radius:10px !important;
}


  #navigation-panel button, a{
    border-radius:10px !important;
  }


    #navigation-panel {
     max-width: 740px;
     margin-top: 10px;
     margin-bottom: 5px;
     margin-left: auto;
     margin-right: auto;
     padding: 3px;
     border: 2px solid DarKGray;
     border-radius: 7px 7px 7px 7px;

     /* https://cssgradient.io/ */

     background: #a7d6e8;
     background: linear-gradient(90deg, rgba(203, 231, 242, 0.50) 0%, rgba(203, 242, 206, 1) 33%, rgba(242, 209, 203, 1) 66%, rgba(209, 209, 209, 0.50) 100%);
  }




    .align-center-horizontal {
       max-width: fit-content;
                  margin-left: auto;
                  margin-right: auto;
    }







.fonbg {
            background: linear-gradient(90deg, rgba(203, 231, 242, 0.50) 0%, rgba(203, 242, 206, 1) 33%, rgba(242, 209, 203, 1) 66%, rgba(209, 209, 209, 0.50) 100%);
        }

/* https://www.computerhope.com/htmcolor.htm#color-codes */
/* https://www.htmltables.io/blog/html-table-borders */
  .status-table {
        background-color: rgba(0, 0, 0, 0.3) !important;
        border: 3px solid  black;
        border-collapse: separate;


        table-layout: fixed;
        width: 100%;

    }
    .status-table td,
    .status-table th{
        border: 0px solid black;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;

    }
     .status-table th{
        color: WhiteSmoke;
    }
    .normal-table-row{
         background-color: white;

    }


    .status-table td a,
    .status-table td span {
      display: inline-block;      /* veya block */
      max-width: 100%;            /* td'nin genişliğini aşamasın */
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      vertical-align: middle;
    }



          .entry-with-content {
              color: blue !important;
              font-weight:bold;
          }


          #topic-name {
            white-space: nowrap;
            overflow: hidden;
            position: relative;
            max-width: 200px;
          }

          #category-name {
            white-space: nowrap;
            overflow: hidden;
            position: relative;
            max-width: 100px;
          }




                        a {
                    text-decoration: none;
                    color: inherit;
                    }

                    a:visited {
                        color: inherit;
                    }

                    a:hover {
                        color: blue;
                    }

                .centered {
                max-width: fit-content;
                  margin-left: auto;
                  margin-right: auto;
                  }

                .pivot-table-entry-cell {
                    text-align: center;      /* yatay ortalama */
                    vertical-align: middle;  /* dikey ortalama */
                    min-width: 20px;
                    min-height: 20px;

                    max-width: 20px;         /* Maksimum genişlik  */
                    max-height: 20px;         /* Maksimum genişlik  */

                    width: 20px;             /* Sabit genişlik  */
                    height: 20px;
                    padding: 0px;

                    background-color: WhiteSmoke !important;

                }

                .pivot-table-entry-cell a {
                text-decoration: none;   /* alt çizgiyi kaldır */
                color: inherit;          /* bulunduğu hücrenin rengini kullan */
                    padding: 0px;

                }

                .pivot-table-entry-cell a:visited {
                    color: inherit;          /* tıklanmış linkin rengini değiştirme */
                }

                 caption {
                    color: WhiteSmoke !important;
                }



                .status-0 {
                 /*   background-color: gainsboro !important; */
                 background: radial-gradient(circle, gainsboro 30%, rgba(255, 255, 255, 1) 100%);

                }
                .status-1 {
                   /* background-color: palegreen !important; */
                    background: radial-gradient(circle, palegreen 30%, rgba(255, 255, 255, 1) 100%);

                }
                .status-2 {
                /*    background-color: tomato !important; */
                background: radial-gradient(circle, Tomato 30%, rgba(255, 255, 255, 1) 100%);

                }
                .status-3 {
                    background-color: LightBlue !important;
                }


        a.add-new-entry {
                  color: transparent;
                  transition: color 0.3s ease;

                  min-width: 20px;
                  min-height: 20px;

                  max-width: 20px;         /* Maksimum genişlik  */
                  max-height: 20px;         /* Maksimum genişlik  */

                  width: 20px;             /* Sabit genişlik  */
                  height: 20px;
                  padding: 0px;
                }

                a.add-new-entry:hover {
                  color: black;
                  background-color:honeydew;
                  font-size: 16px;
                  font-weight: bold;

                  min-width: 20px;
                  min-height: 20px;

                  max-width: 20px;         /* Maksimum genişlik  */
                  max-height: 20px;         /* Maksimum genişlik  */

                  width: 20px;             /* Sabit genişlik  */
                  height: 20px;
                  padding: 0px;
                }

    </style>

    <style>
        .table-wrapper {
          overflow-x: auto;
          max-width: 100%;
        }

/*
        table.status-table {
          border-collapse: collapse;
          white-space: nowrap;
        }

        table.status-table th,
        table.status-table td {
          border: 1px solid black;
          padding: 4px;
          text-align: left;
        }
*/
        /* Mobil için gizle/göster */
        @media (max-width: 768px) {
          .scroll-controls {
            display: flex;
            justify-content: center;
            margin: 5px 0;
            gap: 10px;
          }
        }

        @media (min-width: 769px) {
          .scroll-controls {
            display: none; /* Masaüstünde buton yok */
          }
        }
    </style>
</head>
<body>


<div  id="navigation-panel">
    <div th:replace="~{fragments/fragnavigation :: fragnavigation}"></div>

    <div class="scroll-controls" style="text-align: center;">
        <button onclick="prevCols()" class="btn btn-sm btn-secondary" title="Swipe Left">
            ◀️ Swipe Left
        </button>
        <button onclick="nextCols()" class="btn btn-sm btn-secondary" title="Swipe Right">
             Swipe Right ▶️
        </button>
    </div>
</div>

<div class="align-center-horizontal" style="margin-top:4px;">
    <h1><span class="fonbg">Intelligent Report</span>
        <span th:if="${categoryGroupId == null}" style="font-size:14pt;">(Over all Category Groups)</span>
        <span th:if="${categoryGroupId != null}" style="font-size:14pt;">(Over a Category Group)</span>
    </h1>

    <!--/* thymeleaf icin "templates/" dizini root dizindir. HTML relative pathleri oradan itibaren yazmak gerekir. */-->

    <h3 title="If topic weight is more than or equal to zero and category is not archived"><span class="fonbg">Items</span>

        <a  th:if="${categoryGroupId == null}" href="/reports/allPrint" class="btn btn-secondary btn-sm" style="color:white;" title="Download as printable PDF"><i class="fa-regular fa-file-pdf" style="color: PaleGreen;"></i></a>
        <a  th:if="${categoryGroupId != null}" th:href="${ '/reports/allPrint?categoryGroupId=' + categoryGroupId }" class="btn btn-secondary btn-sm" style="color:white;" title="Print"><i class="fa-regular fa-file-pdf" style="color: PaleGreen;"></i></a>
        &nbsp;
        <a  th:if="${categoryGroupId == null}" href="/reports/allPrint?exclude0=1" class="btn btn-secondary btn-sm" style="color:white;" title="Download as printable PDF without finished entries"><i class="fa-regular fa-file-pdf" style="color: LightBlue;"></i></a>
        <a  th:if="${categoryGroupId != null}" th:href="${ '/reports/allPrint?categoryGroupId=' + categoryGroupId + '&exclude0=1'}" class="btn btn-secondary btn-sm" style="color:white;" title="Print"><i class="fa-regular fa-file-pdf" style="color: LightBlue;"></i></a>

    </h3>

    <div th:replace="~{view-intelligent/fragtable :: fragtable(${allItems}, 'status-table-1')}"></div>
    <br/>

    <h3><span class="fonbg">Archived Items</span></h3>
    <div th:replace="~{view-intelligent/fragtable :: fragtable(${archivedItems}, 'status-table-2')}"></div>
    <br/>

    <h3><span class="fonbg">Items (Not Important)</span></h3>
    <div th:replace="~{view-intelligent/fragtable :: fragtable(${negativeWeightItems}, 'status-table-3')}"></div>
    <br/>

    <h3><span class="fonbg">Archived Items (Not Important)</span></h3>
    <div th:replace="~{view-intelligent/fragtable :: fragtable(${negativeWeightArchivedItems}, 'status-table-4')}"></div>
    <br/>


</div>

<!--/* sayfanın en altına yakın bir yere ekleyin */-->
<div class="modal fade" id="noteModal" tabindex="-1" aria-labelledby="noteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="noteModalLabel">Note Detail</h5>
                &nbsp;
                <button type="button" class="btn btn-outline-secondary btn-sm" id="copyNoteBtn">Copy</button>

                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="white-space: pre-line;height: 600px;overflow-y:scroll;">
                <!--/* HTMX ile buraya tam içerik gelecek, pre-line sayesinde satirlar yanyana degil altalta gorunuyor */-->
            </div>
        </div>
    </div>
</div>

<!--/* Modal yapısı weekly entry calendar icin */-->
<div id="modal" class="modal text-center" style="display:none;background-color:rgba(0, 0, 0, 0.5);">
    <button onclick="document.getElementById('modal').style.display='none'"
            style="background-color:WhiteSmoke;"
    >Close</button>
    <div class="modal-content" id="modal-content">
        <!--/* İçerik buraya yüklenecek */-->
    </div>
</div>


<script type="text/javascript" th:src="@{/webjars/htmx.org/dist/htmx.min.js}"></script>


<script type="text/javascript"
        th:src="@{/webjars/bootstrap/5.3.7/js/bootstrap.min.js}"></script>

<!--/* chart */-->
<script type="text/javascript" th:src="@{/webjars/chart.js/4.5.0/dist/chart.umd.js}"></script>
<!--/* <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script> */-->
<script th:src="@{/js/chartjs-plugin-annotation.js}"></script>
<!--/* https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js */-->
<script th:src="@{/js/chartjs-adapter-date-fns.bundle.min.js}"></script>

<!--/* Modal yapısı weekly entry calendar icin */-->
<script>
    // Modal disina tıklaninca da modali kapatmak icin bu script gerekli cunku kutuphaneli bir modal kullanmadik.
    document.getElementById('modal').addEventListener('click', function (event) {
        const modalContent = document.getElementById('modal-content');
        if (!modalContent.contains(event.target)) {
            this.style.display = 'none';
        }
    });
</script>

<script>
    // HTMX olayı: içerik yüklendikten hemen sonra
    document.body.addEventListener('htmx:afterSwap', function(evt) {
      // Eğer swap hedefi modal-body içindeyse
      if (evt.detail.target.closest('#noteModal .modal-body')) {
        // Bootstrap modal’ı göster
        var modalEl = document.getElementById('noteModal');
        var modal = new bootstrap.Modal(modalEl);
        modal.show();

        // Copy butonunu bağla
        document.getElementById('copyNoteBtn').onclick = function() {
          var text = modalEl.querySelector('.modal-body').innerText;
          navigator.clipboard.writeText(text)
            .then(() => {/* dilerseniz kullanıcıya bildirim gösterin */});
        };
      }
    });
</script>

<!--/* Script that causes all .status-table tables to shift left one column at a time when they are below a certain resolution. */-->
<!--/* Two swipe buttons appear, they are used to scroll. */-->
<script>

    let tables = [];
    let startIndex = 3; // 0 from first column. I set it to 3 to show (diff days, date, topic name, entry status) on small mobile screen by default.
    const windowSize = 4; // number of columns to display simultaneously on a small mobile screen

    document.addEventListener("DOMContentLoaded", () => {
      tables = Array.from(document.querySelectorAll(".status-table"));

      handleResize(); // sayfa yüklenince çalışsın

      window.addEventListener("resize", handleResize);
    });

    function handleResize() {
      if (window.innerWidth <= 768) {
        showColumns(); // mobil görünüme geç
      } else {
        resetColumns(); // masaüstü görünüme geç
      }
    }

    function showColumns() {
      tables.forEach(table => {
        const cols = table.querySelectorAll("thead th");
        cols.forEach((col, i) => {
          const show = i >= startIndex && i < startIndex + windowSize;
          table.querySelectorAll("tr").forEach(row => {
            if (row.cells[i]) {
              row.cells[i].style.display = show ? "" : "none";
            }
          });
        });
      });
    }

    function resetColumns() {
      tables.forEach(table => {
        table.querySelectorAll("tr").forEach(row => {
          Array.from(row.cells).forEach(cell => {
            cell.style.display = ""; // hepsini geri aç
          });
        });
      });
      startIndex = 0; // swipe başlangıcını sıfırla
    }

    function nextCols() {
      const cols = tables[0]?.querySelectorAll("thead th");
      if (cols && startIndex + windowSize < cols.length) {
        startIndex++;
        showColumns();
      }
    }

    function prevCols() {
      if (startIndex > 0) {
        startIndex--;
        showColumns();
      }
    }

</script>

<!--/* Mobile swipe support - Let's add a touch event so it works with a finger without a button: */-->
<script>

    let touchStartX = 0;

    document.addEventListener("touchstart", e => {
      touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener("touchend", e => {
      const touchEndX = e.changedTouches[0].screenX;
      const diff = touchEndX - touchStartX;

      if (Math.abs(diff) > 50) { // min kaydırma mesafesi
        if (diff < 0) {
          nextCols();
        } else {
          prevCols();
        }
      }
    });

</script>

</body>
</html>
